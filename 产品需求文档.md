## 调音风格匹配工具 — 产品需求文档（PRD）

### 1. 背景与目标
- **问题**: 大量平台（如抖音）存在“已调音”风格的音频，创作者希望将任意“未调音音频”一键处理到与参考音频风格一致，且不限时长。
- **目标**: 支持上传一段“已调音参考音频”和一段“未调音音频”，自动输出风格一致的结果，并允许导出/复用处理链（预设）。

### 2. 用户与场景
- **目标用户**: 音乐/短视频创作者、播客编辑、运营同学、工作室工程师。
- **核心场景**:
  - 快速匹配某首歌/视频的调音风格，批量应用到同类素材。
  - 同源素材对比（A/B），将未调音版本恢复到参考版本的效果。
  - 长音频（直播/播客）离线渲染与参数预设沉淀。

### 3. 功能需求（必选）
1) **音频导入**: 支持 WAV/FLAC/MP3/AAC；采样率自动统一；声道保持。
2) **两种模式**:
   - A 配对模式：参考与未调音为同一素材前后版本；自动时间/相位对齐。
   - B 风格模式：参考与未调音异源；学习“风格统计量”泛化到任意音频。
3) **风格匹配处理**:
   - EQ 匹配、响度匹配、限制器；混响/空间匹配（IR/动态卷积）。
   - 动态处理反演（压缩器阈值/比率/攻防时）；饱和/谐波激励拟合。
   - 立体声像（M/S 宽度/相位）；可选音高/时长（移调/校正/伸缩）。
4) **不限时长渲染**: 流式分块、断点续渲；长文件稳定输出。
5) **结果导出**: 音频文件（WAV、MP3）；风格预设（可移植参数链）。
6) **可编辑性**: 自动匹配后，提供可解释参数面板，可手动微调并回写预设。
7) **对比与可视化**: 频谱/响度/F0 曲线叠加，AB 快捷切换。

### 4. 增强功能（可迭代）
- 多段动态/饱和；调制/合唱/镶边识别；人声专用 Auto-Tune 风格参数。
- 批处理队列；一键生成 Preset 包并分享/导入导出。
- 插件形态（VST3/AU/CLAP）与桌面独立版共享核心。

### 5. 非功能需求
- **准确性**: 与参考风格的一致性：
  - 多分辨率 STFT/Mel 距离下降 ≥ 20%（相对未处理）。
  - LUFS 误差 |Δ| ≤ 0.5 LU；F0 偏差均值 ≤ 15 cents（开启音高校正时）。
- **性能**: 单通道 10 分钟音频离线渲染 ≤ 2 分钟（含分析），4 核 CPU 基准；
  - 实时预览 ≥ 0.7× 实时（开启低开销路径）。
- **稳定性**: 失败率 ≤ 0.5%；长音频无爆音/断续；尾音平滑。
- **兼容性**: Windows/macOS/Linux；云端推理 API；浏览器试用（降采样）。
- **安全与合规**: 文件加密存储（对象存储私有桶），访问鉴权；
  - 不分发第三方受版权内容，仅导出功能等效参数与自采 IR。

### 6. 指标与监控
- 任务成功率、平均处理时长、CPU/GPU 占用、峰值内存、磁盘 I/O。
- 音频客观指标：STFT/Mel 距离、LUFS 误差、真峰值（TP）、过载率。
- 用户行为：预设复用率、回调编辑率、AB 偏好。

### 7. 验收标准
- 端到端：上传参考与待处理音频，得到风格一致的输出，支持下载与预设导出。
- A/B 对比图可视化齐全；批处理可成功跑通 ≥ 100 个 5 分钟文件。
- 资源占用与性能达成上述非功能要求；日志/监控/告警上线。

### 8. 版本里程碑
- v0.1（MVP，4-6 周）：Match EQ + LUFS/限制器 + IR 卷积 + 全局移调；基本可视化；离线渲染。
- v0.2（增强，6-10 周）：压缩器反演、立体声像、基础饱和、多段；批处理与队列。
- v0.3（风格泛化，8-12 周）：可微 DSP + 小模型风格抽象；Preset 生态。

### 9. 风险与对策
- 非线性/并行链路难反演 → 结构先验 + 可微 DSP 拟合；
- 盲去卷积不适定 → 频带正则 + 早反射/尾部分离 + 动态卷积；
- 长音频状态管理 → Overlap-Add + 状态持久 + 尾音拼接策略；
- 客观指标与听感偏差 → 小规模盲听闭环校准；
- 版权合规 → 明示用户权责，避免分发第三方受保护内容。


