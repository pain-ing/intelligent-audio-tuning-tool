"use strict";(self.webpackChunkaudio_style_matching_frontend=self.webpackChunkaudio_style_matching_frontend||[]).push([[76],{5530:(e,t,s)=>{s.d(t,{fE:()=>a,wr:()=>o});var r=s(287);const n=e=>{if(0===e)return"0 B/s";const t=Math.floor(Math.log(e)/Math.log(1024));return"".concat((e/Math.pow(1024,t)).toFixed(1)," ").concat(["B/s","KB/s","MB/s","GB/s"][t])},i=e=>{if(0===e||!isFinite(e))return"\u8ba1\u7b97\u4e2d...";const t=Math.floor(e/60),s=Math.floor(e%60);return t>0?"".concat(t,"\u5206").concat(s,"\u79d2"):"".concat(s,"\u79d2")},l=r.A.create({baseURL:"http://localhost:8080",timeout:6e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>(e.metadata={startTime:new Date},e),e=>Promise.reject(e)),l.interceptors.response.use(e=>{if(e.config.metadata){const t=new Date-e.config.metadata.startTime;console.log("API\u8bf7\u6c42\u8017\u65f6: ".concat(t,"ms - ").concat(e.config.url))}return e.data},e=>{if("ECONNABORTED"!==e.code){if(e.response){const{status:t,data:s}=e.response;switch(t){case 401:e.message="\u8ba4\u8bc1\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55";break;case 403:e.message="\u6743\u9650\u4e0d\u8db3\uff0c\u65e0\u6cd5\u8bbf\u95ee\u8be5\u8d44\u6e90";break;case 404:e.message="\u8bf7\u6c42\u7684\u8d44\u6e90\u4e0d\u5b58\u5728";break;case 413:e.message="\u6587\u4ef6\u8fc7\u5927\uff0c\u8bf7\u9009\u62e9\u5c0f\u4e8e100MB\u7684\u6587\u4ef6";break;case 415:e.message="\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8bf7\u4f7f\u7528WAV\u3001MP3\u6216FLAC\u683c\u5f0f";break;case 422:e.message=(null===s||void 0===s?void 0:s.detail)||"\u8bf7\u6c42\u53c2\u6570\u9519\u8bef";break;case 429:e.message="\u8bf7\u6c42\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5";break;case 500:e.message="\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";break;case 502:case 503:case 504:e.message="\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";break;default:e.message=(null===s||void 0===s?void 0:s.message)||(null===s||void 0===s?void 0:s.detail)||"\u8bf7\u6c42\u5931\u8d25"}return Promise.reject(e)}return e.request?(console.error("Network error:",e.message),Promise.reject("\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8bbe\u7f6e")):(console.error("Error:",e.message),Promise.reject(e.message))}e.message="\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5"});const a={healthCheck:()=>l.get("/health"),getUploadSignature:(e,t)=>l.post("/uploads/sign",{content_type:e,extension:t}),createJob:e=>l.post("/jobs",e),getJobStatus:e=>l.get("/jobs/".concat(e)),cancelJob:e=>l.post("/jobs/".concat(e,"/cancel")),listJobs:function(){let{user_id:e,status:t,limit:s=20,cursor:r,sort_by:n="created_at",order:i="desc",created_after:a,created_before:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l.get("/jobs",{params:{user_id:e,status:t,limit:s,cursor:r,sort_by:n,order:i,created_after:a,created_before:o}})},getJobStats:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l.get("/jobs/stats",{params:e})},retryJob:e=>l.post("/jobs/".concat(e,"/retry")),cancelJob:e=>l.post("/jobs/".concat(e,"/cancel")),getPresets:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l.get("/presets",{params:e})},createPreset:e=>l.post("/presets",e),updatePreset:(e,t)=>l.put("/presets/".concat(e),t),deletePreset:e=>l.delete("/presets/".concat(e)),getPreset:e=>l.get("/presets/".concat(e))},o={uploadToStorage:async(e,t,s)=>{try{return await r.A.put(t,e,{headers:{"Content-Type":e.type},onUploadProgress:e=>{if(s&&e.total){const t=Math.round(100*e.loaded/e.total),r=e.rate||0,l=r>0?(e.total-e.loaded)/r:0;s({loaded:e.loaded,total:e.total,percent:t,speed:r,timeRemaining:l,speedText:n(r),timeText:i(l)})}},timeout:3e5})}catch(c){var l,a,o;throw"ECONNABORTED"===c.code?new Error("\u4e0a\u4f20\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u6216\u5c1d\u8bd5\u4e0a\u4f20\u8f83\u5c0f\u7684\u6587\u4ef6"):413===(null===(l=c.response)||void 0===l?void 0:l.status)?new Error("\u6587\u4ef6\u8fc7\u5927\uff0c\u8bf7\u9009\u62e9\u8f83\u5c0f\u7684\u6587\u4ef6"):(null===(a=c.response)||void 0===a?void 0:a.status)>=500?new Error("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"):403===(null===(o=c.response)||void 0===o?void 0:o.status)?new Error("\u4e0a\u4f20\u6743\u9650\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u83b7\u53d6\u4e0a\u4f20\u94fe\u63a5"):new Error("\u4e0a\u4f20\u5931\u8d25: ".concat(c.message||"\u672a\u77e5\u9519\u8bef"))}},uploadLargeFile:async(e,t,s)=>{const n=5242880,i=Math.ceil(e.size/n),l=[];for(let a=0;a<i;a++){const o=a*n,c=Math.min(o+n,e.size),d=e.slice(o,c),x=r.A.put(t[a],d,{headers:{"Content-Type":"application/octet-stream"},onUploadProgress:e=>{if(s){const t=e.loaded/e.total*100,r=(100*a+t)/i;s(Math.round(r))}}});l.push(x)}return Promise.all(l)}}},7076:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ae});var r=s(9379),n=s(9950),i=s(4369),l=s(2056),a=s(6120),o=s(6004),c=s(7094),d=s(1988),x=s(8864),u=s(5369),h=s(4571),m=s(3072),p=s(4209),g=s(1967),j=s(7379),A=s(9083),y=s(8114),f=s(6014),v=s(2858),b=s(4070),E=s(3965),R=s(8349),_=s(4414);const{Text:S,Title:w}=i.A,T=e=>{let{onFileSelect:t,accept:s="audio/*",title:i="\u4e0a\u4f20\u97f3\u9891\u6587\u4ef6",description:a="\u652f\u6301 WAV\u3001MP3\u3001FLAC \u7b49\u683c\u5f0f",file:c=null,maxSize:d=104857600}=e;const[h,m]=(0,n.useState)(!1),[p,j]=(0,n.useState)(0),A=(0,n.useCallback)(async e=>{if(0===e.length)return;const s=e[0];if(s.size>d)v.Ay.error("\u6587\u4ef6\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 ".concat(Math.round(d/1024/1024),"MB"));else if(s.type.startsWith("audio/"))try{m(!0),j(0);const e=setInterval(()=>{j(t=>t>=90?(clearInterval(e),90):t+10)},200);await t(s),clearInterval(e),j(100),setTimeout(()=>{m(!1),j(0)},500)}catch(r){m(!1),j(0)}else v.Ay.error("\u8bf7\u9009\u62e9\u97f3\u9891\u6587\u4ef6")},[t,d]),{getRootProps:y,getInputProps:T,isDragActive:C}=(0,f.VB)({onDrop:A,accept:{"audio/*":[".wav",".mp3",".flac",".aac",".ogg",".m4a"]},multiple:!1,disabled:h}),k=e=>{e.stopPropagation(),t(null)},F=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]};var M;return c&&!h?(0,_.jsx)(l.A,{className:"file-uploaded",children:(0,_.jsx)(o.A,{direction:"vertical",style:{width:"100%"},children:(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,_.jsxs)(o.A,{children:[(0,_.jsx)(g.A,{style:{color:"#52c41a",fontSize:"20px"}}),(0,_.jsxs)("div",{children:[(0,_.jsx)(w,{level:5,style:{margin:0},children:c.name}),(0,_.jsxs)(S,{type:"secondary",children:[F((null===(M=c.file)||void 0===M?void 0:M.size)||0)," \u2022 \u65f6\u957f: ",(c.file,"\u672a\u77e5")]})]})]}),(0,_.jsx)(u.Ay,{type:"text",danger:!0,icon:(0,_.jsx)(b.A,{}),onClick:k,children:"\u79fb\u9664"})]})})}):(0,_.jsx)("div",{children:(0,_.jsxs)("div",(0,r.A)((0,r.A)({},y()),{},{className:"upload-area ".concat(C?"dragover":""," ").concat(h?"uploading":""),style:{opacity:h?.7:1,pointerEvents:h?"none":"auto"},children:[(0,_.jsx)("input",(0,r.A)({},T())),h?(0,_.jsxs)(o.A,{direction:"vertical",align:"center",children:[(0,_.jsx)(E.A,{style:{fontSize:"48px",color:"#1890ff"}}),(0,_.jsx)(w,{level:4,style:{margin:"16px 0 8px"},children:"\u4e0a\u4f20\u4e2d..."}),(0,_.jsx)(x.A,{percent:p,style:{width:"200px"},strokeColor:{"0%":"#108ee9","100%":"#87d068"}})]}):(0,_.jsxs)(o.A,{direction:"vertical",align:"center",children:[(0,_.jsx)(R.A,{style:{fontSize:"48px",color:"#d9d9d9"}}),(0,_.jsx)(w,{level:4,style:{margin:"16px 0 8px"},children:C?"\u91ca\u653e\u6587\u4ef6\u4ee5\u4e0a\u4f20":i}),(0,_.jsx)(S,{type:"secondary",style:{marginBottom:"16px"},children:a}),(0,_.jsx)(S,{type:"secondary",style:{fontSize:"12px"},children:"\u62d6\u62fd\u6587\u4ef6\u5230\u6b64\u5904\uff0c\u6216\u70b9\u51fb\u9009\u62e9\u6587\u4ef6"}),(0,_.jsxs)(S,{type:"secondary",style:{fontSize:"12px"},children:["\u6700\u5927\u6587\u4ef6\u5927\u5c0f: ",Math.round(d/1024/1024),"MB"]})]})]}))})};var C=s(5448),k=s(8571),F=s(4889),M=s(8077),I=s(2186);const{Text:L}=i.A,O=e=>{let{file:t,url:s,title:r="\u97f3\u9891\u64ad\u653e\u5668"}=e;const[i,a]=(0,n.useState)(!1),[c,d]=(0,n.useState)(0),[x,h]=(0,n.useState)(0),[m,p]=(0,n.useState)(.7),[g,j]=(0,n.useState)(null),A=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(t){const e=URL.createObjectURL(t);return j(e),()=>URL.revokeObjectURL(e)}s&&j(s)},[t,s]),(0,n.useEffect)(()=>{const e=A.current;if(!e)return;const t=()=>{d(e.duration)},s=()=>{h(e.currentTime)},r=()=>{a(!1),h(0)};return e.addEventListener("loadedmetadata",t),e.addEventListener("timeupdate",s),e.addEventListener("ended",r),()=>{e.removeEventListener("loadedmetadata",t),e.removeEventListener("timeupdate",s),e.removeEventListener("ended",r)}},[g]);const y=e=>{if(isNaN(e))return"0:00";const t=Math.floor(e/60),s=Math.floor(e%60);return"".concat(t,":").concat(s.toString().padStart(2,"0"))};return g?(0,_.jsxs)(l.A,{className:"audio-player",title:r,children:[(0,_.jsx)("audio",{ref:A,src:g,preload:"metadata"}),(0,_.jsxs)(o.A,{direction:"vertical",style:{width:"100%"},children:[(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,_.jsx)(u.Ay,{type:"text",icon:(0,_.jsx)(k.A,{}),onClick:()=>{const e=A.current;e&&(e.currentTime=Math.max(0,e.currentTime-10))},title:"\u540e\u9000 10 \u79d2"}),(0,_.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",icon:i?(0,_.jsx)(F.A,{}):(0,_.jsx)(M.A,{}),onClick:()=>{const e=A.current;e&&(i?e.pause():e.play(),a(!i))}}),(0,_.jsx)(u.Ay,{type:"text",icon:(0,_.jsx)(I.A,{}),onClick:()=>{const e=A.current;e&&(e.currentTime=Math.min(c,e.currentTime+10))},title:"\u524d\u8fdb 10 \u79d2"}),(0,_.jsx)("div",{style:{flex:1,marginLeft:"16px"},children:(0,_.jsx)(C.A,{value:c>0?x/c*100:0,onChange:e=>{const t=A.current;if(!t)return;const s=e/100*c;t.currentTime=s,h(s)},tooltip:{formatter:e=>y(e/100*c)}})}),(0,_.jsxs)(L,{style:{minWidth:"80px",textAlign:"center"},children:[y(x)," / ",y(c)]})]}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,_.jsx)(E.A,{}),(0,_.jsx)(C.A,{style:{flex:1,maxWidth:"150px"},value:100*m,onChange:e=>{const t=A.current;if(!t)return;const s=e/100;t.volume=s,p(s)},tooltip:{formatter:e=>"".concat(Math.round(e),"%")}})]})]})]}):(0,_.jsx)(l.A,{className:"audio-player disabled",children:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(E.A,{style:{color:"#d9d9d9"}}),(0,_.jsx)(L,{type:"secondary",children:"\u6682\u65e0\u97f3\u9891"})]})})};var z=s(6483),N=s(7098),P=s(1598),B=s(3822);const{Title:U,Text:D}=i.A,q=e=>{var t,s,r,n,i;let{jobStatus:a,style:x}=e;if(!a)return null;const u=a.metrics||{},h=a.style_params||{};return(0,_.jsxs)(l.A,{title:"\u53ef\u89c6\u5316\u5206\u6790",style:x,children:[(0,_.jsxs)(c.A,{gutter:[16,16],style:{marginBottom:24},children:[(0,_.jsx)(d.A,{xs:12,sm:6,children:(0,_.jsx)(z.A,{title:"LUFS \u54cd\u5ea6",value:(null===(t=h.lufs)||void 0===t?void 0:t.target_lufs)||-23,precision:1,suffix:"LU",prefix:(0,_.jsx)(E.A,{})})}),(0,_.jsx)(d.A,{xs:12,sm:6,children:(0,_.jsx)(z.A,{title:"\u771f\u5cf0\u503c",value:(null===(s=h.limiter)||void 0===s?void 0:s.tp_db)||-1,precision:1,suffix:"dB",prefix:(0,_.jsx)(N.A,{})})}),(0,_.jsx)(d.A,{xs:12,sm:6,children:(0,_.jsx)(z.A,{title:"EQ \u6bb5\u6570",value:(null===(r=h.eq)||void 0===r?void 0:r.length)||0,prefix:(0,_.jsx)(P.A,{})})}),(0,_.jsx)(d.A,{xs:12,sm:6,children:(0,_.jsx)(z.A,{title:"\u5904\u7406\u8d28\u91cf",value:100*(1-(u.artifacts_rate||0)),precision:1,suffix:"%"})})]}),(0,_.jsxs)(c.A,{gutter:[16,16],children:[(0,_.jsx)(d.A,{xs:24,lg:12,children:(0,_.jsx)(B.A,{option:(()=>{var e;const t=(null===a||void 0===a||null===(e=a.style_params)||void 0===e?void 0:e.eq)||[],s=[],r=[];for(let n=0;n<200;n++){const e=20*Math.pow(1e3,n/199);s.push(e);let i=0;t.forEach(t=>{if("peaking"===t.type){const s=e/t.f_hz,r=t.gain_db/(1+t.q*Math.pow(s-1/s,2));i+=r}}),r.push(i)}return{title:{text:"EQ \u9891\u7387\u54cd\u5e94",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:e=>{const t=e[0].data[0],s=e[0].data[1];return"\u9891\u7387: ".concat(t<1e3?t.toFixed(0)+"Hz":(t/1e3).toFixed(1)+"kHz","<br/>\u589e\u76ca: ").concat(s.toFixed(1),"dB")}},xAxis:{type:"log",name:"\u9891\u7387 (Hz)",nameLocation:"middle",nameGap:30,min:20,max:2e4,axisLabel:{formatter:e=>e>=1e3?e/1e3+"k":e}},yAxis:{type:"value",name:"\u589e\u76ca (dB)",nameLocation:"middle",nameGap:40},series:[{data:s.map((e,t)=>[e,r[t]]),type:"line",smooth:!0,lineStyle:{color:"#1890ff",width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(24, 144, 255, 0.3)"},{offset:1,color:"rgba(24, 144, 255, 0.1)"}]}}}],grid:{left:"10%",right:"5%",bottom:"15%",top:"15%"}}})(),style:{height:"300px"},opts:{renderer:"svg"}})}),(0,_.jsx)(d.A,{xs:24,lg:12,children:(0,_.jsx)(B.A,{option:(()=>{const e=(()=>{if(null===a||void 0===a||!a.metrics)return[];const e=[],t=[];for(let s=0;s<50;s++){const r=20*Math.pow(2,s/8);if(r>2e4)break;e.push(r),t.push(40*Math.random()-20)}return e.map((e,s)=>[e,t[s]])})();return{title:{text:"\u9891\u8c31\u5bf9\u6bd4",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:e=>{const t=e[0].data[0],s=e[0].data[1];return"\u9891\u7387: ".concat(t<1e3?t.toFixed(0)+"Hz":(t/1e3).toFixed(1)+"kHz","<br/>\u5e45\u5ea6: ").concat(s.toFixed(1),"dB")}},legend:{data:["\u539f\u59cb","\u5904\u7406\u540e"],bottom:0},xAxis:{type:"log",name:"\u9891\u7387 (Hz)",nameLocation:"middle",nameGap:30,min:20,max:2e4,axisLabel:{formatter:e=>e>=1e3?e/1e3+"k":e}},yAxis:{type:"value",name:"\u5e45\u5ea6 (dB)",nameLocation:"middle",nameGap:40},series:[{name:"\u539f\u59cb",data:e,type:"line",smooth:!0,lineStyle:{color:"#ff4d4f",width:2}},{name:"\u5904\u7406\u540e",data:e.map(e=>{let[t,s]=e;return[t,s+4*Math.random()-2]}),type:"line",smooth:!0,lineStyle:{color:"#52c41a",width:2}}],grid:{left:"10%",right:"5%",bottom:"20%",top:"15%"}}})(),style:{height:"300px"},opts:{renderer:"svg"}})})]}),(0,_.jsx)(c.A,{gutter:[16,16],style:{marginTop:16},children:(0,_.jsx)(d.A,{xs:24,children:(0,_.jsx)(B.A,{option:(()=>{const e=[],t=[],s=[];for(let r=0;r<100;r++)e.push(r/10),t.push(20*Math.random()-10),s.push(16*Math.random()-8);return{title:{text:"\u52a8\u6001\u8303\u56f4\u5bf9\u6bd4",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:e=>{const t=e[0].axisValue;return"\u65f6\u95f4: ".concat(t,"s<br/>").concat(e.map(e=>"".concat(e.seriesName,": ").concat(e.data.toFixed(1),"dB")).join("<br/>"))}},legend:{data:["\u539f\u59cb","\u5904\u7406\u540e"],bottom:0},xAxis:{type:"category",data:e,name:"\u65f6\u95f4 (s)",nameLocation:"middle",nameGap:30},yAxis:{type:"value",name:"\u7535\u5e73 (dB)",nameLocation:"middle",nameGap:40},series:[{name:"\u539f\u59cb",data:t,type:"line",smooth:!0,lineStyle:{color:"#ff4d4f",width:1},symbol:"none"},{name:"\u5904\u7406\u540e",data:s,type:"line",smooth:!0,lineStyle:{color:"#52c41a",width:1},symbol:"none"}],grid:{left:"10%",right:"5%",bottom:"20%",top:"15%"}}})(),style:{height:"250px"},opts:{renderer:"svg"}})})}),(0,_.jsxs)("div",{style:{marginTop:24,padding:16,background:"#fafafa",borderRadius:8},children:[(0,_.jsx)(U,{level:5,children:"\u5904\u7406\u4fe1\u606f"}),(0,_.jsxs)(o.A,{direction:"vertical",children:[(0,_.jsxs)(D,{children:[(0,_.jsx)("strong",{children:"\u5904\u7406\u6a21\u5f0f:"})," ",(null===(n=h.metadata)||void 0===n?void 0:n.mode)||"A"," \u6a21\u5f0f"]}),(0,_.jsxs)(D,{children:[(0,_.jsx)("strong",{children:"\u7f6e\u4fe1\u5ea6:"})," ",(100*((null===(i=h.metadata)||void 0===i?void 0:i.confidence)||.5)).toFixed(0),"%"]}),(0,_.jsxs)(D,{children:[(0,_.jsx)("strong",{children:"STFT \u8ddd\u79bb:"})," ",(u.stft_dist||0).toFixed(3)]}),(0,_.jsxs)(D,{children:[(0,_.jsx)("strong",{children:"Mel \u8ddd\u79bb:"})," ",(u.mel_dist||0).toFixed(3)]}),(0,_.jsxs)(D,{children:[(0,_.jsx)("strong",{children:"LUFS \u8bef\u5dee:"})," ",(u.lufs_err||0).toFixed(1)," LU"]})]})]})]})};var G=s(7984),W=s(8576),V=s(6895),H=s(6276),J=s(7866),K=s(5266),Z=s(2965);const{Panel:Q}=G.A,{Text:X}=i.A,Y=e=>{var t,s,i,a,x,h,m,p,g,j,A,y,f,b,R,S;let{parameters:w,onParametersChange:T,style:k}=e;const[F,M]=(0,n.useState)(w||{}),[I,L]=(0,n.useState)(!1);(0,n.useEffect)(()=>{M(w||{}),L(!1)},[w]);const O=(e,t,s)=>{const n=(0,r.A)((0,r.A)({},F),{},{[e]:(0,r.A)((0,r.A)({},F[e]),{},{[t]:s})});M(n),L(!0)},z=(e,t,s)=>{const n=[...F.eq||[]];n[e]=(0,r.A)((0,r.A)({},n[e]),{},{[t]:s}),M((0,r.A)((0,r.A)({},F),{},{eq:n})),L(!0)},P=e=>e>=1e3?"".concat((e/1e3).toFixed(1),"kHz"):"".concat(e,"Hz");return(0,_.jsxs)(l.A,{title:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(H.A,{}),"\u53c2\u6570\u7f16\u8f91\u5668"]}),extra:I&&(0,_.jsxs)(o.A,{children:[(0,_.jsxs)(u.Ay,{size:"small",onClick:()=>{M(w||{}),L(!1),v.Ay.info("\u53c2\u6570\u5df2\u91cd\u7f6e")},children:[(0,_.jsx)(J.A,{})," \u91cd\u7f6e"]}),(0,_.jsx)(u.Ay,{type:"primary",size:"small",onClick:()=>{T(F),L(!1),v.Ay.success("\u53c2\u6570\u5df2\u5e94\u7528")},children:"\u5e94\u7528\u66f4\u6539"})]}),style:k,children:[(0,_.jsxs)(G.A,{defaultActiveKey:["eq","lufs"],ghost:!0,children:[(0,_.jsx)(Q,{header:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(K.A,{}),"\u5747\u8861\u5668 (",(F.eq||[]).length," \u6bb5)"]}),children:(0,_.jsxs)(o.A,{direction:"vertical",style:{width:"100%"},children:[(F.eq||[]).map((e,t)=>(0,_.jsx)(l.A,{size:"small",title:"EQ ".concat(t+1),extra:(0,_.jsx)(u.Ay,{type:"text",danger:!0,size:"small",onClick:()=>(e=>{const t=(F.eq||[]).filter((t,s)=>s!==e);M((0,r.A)((0,r.A)({},F),{},{eq:t})),L(!0)})(t),children:"\u5220\u9664"}),children:(0,_.jsxs)(c.A,{gutter:[16,16],children:[(0,_.jsxs)(d.A,{xs:24,sm:8,children:[(0,_.jsx)(X,{strong:!0,children:"\u9891\u7387"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:20,max:2e4,value:e.f_hz,onChange:e=>z(t,"f_hz",e),style:{flex:1},tooltip:{formatter:P}}),(0,_.jsx)(W.A,{size:"small",value:e.f_hz,onChange:e=>z(t,"f_hz",e),min:20,max:2e4,style:{width:80},formatter:e=>P(e),parser:e=>e.replace(/[^\d]/g,"")})]})]}),(0,_.jsxs)(d.A,{xs:24,sm:8,children:[(0,_.jsx)(X,{strong:!0,children:"\u589e\u76ca (dB)"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:-20,max:20,step:.1,value:e.gain_db,onChange:e=>z(t,"gain_db",e),style:{flex:1}}),(0,_.jsx)(W.A,{size:"small",value:e.gain_db,onChange:e=>z(t,"gain_db",e),min:-20,max:20,step:.1,style:{width:80}})]})]}),(0,_.jsxs)(d.A,{xs:24,sm:8,children:[(0,_.jsx)(X,{strong:!0,children:"Q \u503c"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:.1,max:10,step:.1,value:e.q,onChange:e=>z(t,"q",e),style:{flex:1}}),(0,_.jsx)(W.A,{size:"small",value:e.q,onChange:e=>z(t,"q",e),min:.1,max:10,step:.1,style:{width:80}})]})]})]})},t)),(0,_.jsx)(u.Ay,{type:"dashed",onClick:()=>{const e=[...F.eq||[],{type:"peaking",f_hz:1e3,gain_db:0,q:1}];M((0,r.A)((0,r.A)({},F),{},{eq:e})),L(!0)},style:{width:"100%"},children:"+ \u6dfb\u52a0 EQ \u6bb5"})]})},"eq"),(0,_.jsx)(Q,{header:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(E.A,{}),"\u54cd\u5ea6\u5f52\u4e00\u5316"]}),children:(0,_.jsx)(c.A,{gutter:[16,16],children:(0,_.jsxs)(d.A,{xs:24,sm:12,children:[(0,_.jsx)(X,{strong:!0,children:"\u76ee\u6807 LUFS"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:-40,max:-6,step:.1,value:(null===(t=F.lufs)||void 0===t?void 0:t.target_lufs)||-23,onChange:e=>O("lufs","target_lufs",e),style:{flex:1}}),(0,_.jsx)(W.A,{size:"small",value:(null===(s=F.lufs)||void 0===s?void 0:s.target_lufs)||-23,onChange:e=>O("lufs","target_lufs",e),min:-40,max:-6,step:.1,style:{width:80},suffix:"LU"})]})]})})},"lufs"),(0,_.jsx)(Q,{header:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(Z.A,{}),"\u52a8\u6001\u538b\u7f29"]}),children:(0,_.jsxs)(c.A,{gutter:[16,16],children:[(0,_.jsx)(d.A,{xs:24,children:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(X,{strong:!0,children:"\u542f\u7528\u538b\u7f29"}),(0,_.jsx)(V.A,{checked:(null===(i=F.compression)||void 0===i?void 0:i.enabled)||!1,onChange:e=>O("compression","enabled",e)})]})}),(null===(a=F.compression)||void 0===a?void 0:a.enabled)&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)(d.A,{xs:24,sm:12,children:[(0,_.jsx)(X,{strong:!0,children:"\u9608\u503c (dB)"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:-40,max:0,value:(null===(x=F.compression)||void 0===x?void 0:x.threshold_db)||-20,onChange:e=>O("compression","threshold_db",e),style:{flex:1}}),(0,_.jsx)(W.A,{size:"small",value:(null===(h=F.compression)||void 0===h?void 0:h.threshold_db)||-20,onChange:e=>O("compression","threshold_db",e),min:-40,max:0,style:{width:80}})]})]}),(0,_.jsxs)(d.A,{xs:24,sm:12,children:[(0,_.jsx)(X,{strong:!0,children:"\u538b\u7f29\u6bd4"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:1,max:20,step:.1,value:(null===(m=F.compression)||void 0===m?void 0:m.ratio)||2,onChange:e=>O("compression","ratio",e),style:{flex:1}}),(0,_.jsx)(W.A,{size:"small",value:(null===(p=F.compression)||void 0===p?void 0:p.ratio)||2,onChange:e=>O("compression","ratio",e),min:1,max:20,step:.1,style:{width:80},suffix:":1"})]})]})]})]})},"compression"),(0,_.jsx)(Q,{header:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(N.A,{}),"\u9650\u5236\u5668"]}),children:(0,_.jsxs)(c.A,{gutter:[16,16],children:[(0,_.jsxs)(d.A,{xs:24,sm:12,children:[(0,_.jsx)(X,{strong:!0,children:"\u771f\u5cf0\u503c\u9650\u5236 (dB)"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:-6,max:0,step:.1,value:(null===(g=F.limiter)||void 0===g?void 0:g.tp_db)||-1,onChange:e=>O("limiter","tp_db",e),style:{flex:1}}),(0,_.jsx)(W.A,{size:"small",value:(null===(j=F.limiter)||void 0===j?void 0:j.tp_db)||-1,onChange:e=>O("limiter","tp_db",e),min:-6,max:0,step:.1,style:{width:80}})]})]}),(0,_.jsxs)(d.A,{xs:24,sm:12,children:[(0,_.jsx)(X,{strong:!0,children:"\u91ca\u653e\u65f6\u95f4 (ms)"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:10,max:1e3,value:(null===(A=F.limiter)||void 0===A?void 0:A.release_ms)||100,onChange:e=>O("limiter","release_ms",e),style:{flex:1}}),(0,_.jsx)(W.A,{size:"small",value:(null===(y=F.limiter)||void 0===y?void 0:y.release_ms)||100,onChange:e=>O("limiter","release_ms",e),min:10,max:1e3,style:{width:80}})]})]})]})},"limiter"),(0,_.jsx)(Q,{header:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(K.A,{}),"\u7acb\u4f53\u58f0\u5904\u7406"]}),children:(0,_.jsx)(c.A,{gutter:[16,16],children:(0,_.jsxs)(d.A,{xs:24,sm:12,children:[(0,_.jsx)(X,{strong:!0,children:"\u7acb\u4f53\u58f0\u5bbd\u5ea6"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:0,max:2,step:.01,value:(null===(f=F.stereo)||void 0===f?void 0:f.width)||1,onChange:e=>O("stereo","width",e),style:{flex:1}}),(0,_.jsx)(W.A,{size:"small",value:(null===(b=F.stereo)||void 0===b?void 0:b.width)||1,onChange:e=>O("stereo","width",e),min:0,max:2,step:.01,style:{width:80}})]})]})})},"stereo"),(0,_.jsx)(Q,{header:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(K.A,{}),"\u97f3\u9ad8\u8c03\u6574"]}),children:(0,_.jsx)(c.A,{gutter:[16,16],children:(0,_.jsxs)(d.A,{xs:24,sm:12,children:[(0,_.jsx)(X,{strong:!0,children:"\u97f3\u9ad8\u504f\u79fb (\u534a\u97f3)"}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,_.jsx)(C.A,{min:-12,max:12,step:.01,value:(null===(R=F.pitch)||void 0===R?void 0:R.semitones)||0,onChange:e=>O("pitch","semitones",e),style:{flex:1}}),(0,_.jsx)(W.A,{size:"small",value:(null===(S=F.pitch)||void 0===S?void 0:S.semitones)||0,onChange:e=>O("pitch","semitones",e),min:-12,max:12,step:.01,style:{width:80}})]})]})})},"pitch")]}),I&&(0,_.jsx)("div",{style:{marginTop:16,padding:12,background:"#fff7e6",border:"1px solid #ffd591",borderRadius:6},children:(0,_.jsx)(X,{type:"warning",children:'\u53c2\u6570\u5df2\u4fee\u6539\uff0c\u70b9\u51fb"\u5e94\u7528\u66f4\u6539"\u4ee5\u91cd\u65b0\u5904\u7406\u97f3\u9891'})})]})},{Text:$}=i.A;var ee=s(5530),te=s(9485);class se{static handleApiError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";console.error("API Error in ".concat(t,":"),e);let s="SERVER_ERROR",r=this.errorMessages.SERVER_ERROR;if(e.response){const{status:t,data:n}=e.response;switch(t){case 400:s=(null===n||void 0===n?void 0:n.code)||"INVALID_INPUT",r=(null===n||void 0===n?void 0:n.message)||"\u8bf7\u6c42\u53c2\u6570\u9519\u8bef";break;case 401:s="UNAUTHORIZED",r=this.errorMessages.UNAUTHORIZED;break;case 403:s="FORBIDDEN",r=this.errorMessages.FORBIDDEN;break;case 404:s="NOT_FOUND",r="\u8bf7\u6c42\u7684\u8d44\u6e90\u4e0d\u5b58\u5728";break;case 413:s="FILE_TOO_LARGE",r=this.errorMessages.FILE_TOO_LARGE;break;case 415:s="UNSUPPORTED_FORMAT",r=this.errorMessages.UNSUPPORTED_FORMAT;break;case 500:s="SERVER_ERROR",r=this.errorMessages.SERVER_ERROR;break;case 504:s="TIMEOUT",r=this.errorMessages.TIMEOUT;break;default:r=(null===n||void 0===n?void 0:n.message)||"\u670d\u52a1\u5668\u9519\u8bef (".concat(t,")")}}else e.request?(s="NETWORK_ERROR",r=this.errorMessages.NETWORK_ERROR):r=e.message||"\u672a\u77e5\u9519\u8bef";return{code:s,message:r,solutions:this.solutions[s]||["\u8bf7\u8054\u7cfb\u6280\u672f\u652f\u6301"]}}static showError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=this.handleApiError(e,t);te.Ay.error({message:"\u64cd\u4f5c\u5931\u8d25",description:(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{style:{marginBottom:8},children:s.message}),(0,_.jsxs)("div",{style:{fontSize:"12px",color:"#666"},children:[(0,_.jsx)("strong",{children:"\u89e3\u51b3\u5efa\u8bae\uff1a"}),(0,_.jsx)("ul",{style:{margin:"4px 0",paddingLeft:"16px"},children:s.solutions.map((e,t)=>(0,_.jsx)("li",{children:e},t))})]})]}),duration:8,style:{backgroundColor:"rgba(16, 40, 50, 0.95)",border:"1px solid #ff4d4f",color:"#B4FFF0"}})}static showSimpleError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=this.handleApiError(e,t);v.Ay.error(s.message)}static showSuccess(e){te.Ay.success({message:"\u64cd\u4f5c\u6210\u529f",description:e,duration:4,style:{backgroundColor:"rgba(16, 40, 50, 0.95)",border:"1px solid #52c41a",color:"#B4FFF0"}})}static showWarning(e){te.Ay.warning({message:"\u6ce8\u610f",description:e,duration:6,style:{backgroundColor:"rgba(16, 40, 50, 0.95)",border:"1px solid #fa8c16",color:"#B4FFF0"}})}}se.errorMessages={NETWORK_ERROR:"\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8bbe\u7f6e",UPLOAD_FAILED:"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",PROCESSING_FAILED:"\u97f3\u9891\u5904\u7406\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u6587\u4ef6\u683c\u5f0f",FILE_TOO_LARGE:"\u6587\u4ef6\u8fc7\u5927\uff0c\u8bf7\u9009\u62e9\u5c0f\u4e8e100MB\u7684\u6587\u4ef6",UNSUPPORTED_FORMAT:"\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8bf7\u4f7f\u7528WAV\u3001MP3\u6216FLAC\u683c\u5f0f",SERVER_ERROR:"\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",TIMEOUT:"\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5",UNAUTHORIZED:"\u672a\u6388\u6743\u8bbf\u95ee\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55",FORBIDDEN:"\u6743\u9650\u4e0d\u8db3\uff0c\u65e0\u6cd5\u6267\u884c\u6b64\u64cd\u4f5c"},se.solutions={NETWORK_ERROR:["\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u662f\u5426\u6b63\u5e38","\u5c1d\u8bd5\u5237\u65b0\u9875\u9762","\u68c0\u67e5\u9632\u706b\u5899\u8bbe\u7f6e"],UPLOAD_FAILED:["\u68c0\u67e5\u6587\u4ef6\u662f\u5426\u635f\u574f","\u786e\u8ba4\u6587\u4ef6\u683c\u5f0f\u6b63\u786e","\u5c1d\u8bd5\u91cd\u65b0\u9009\u62e9\u6587\u4ef6"],PROCESSING_FAILED:["\u786e\u8ba4\u97f3\u9891\u6587\u4ef6\u5b8c\u6574\u4e14\u672a\u635f\u574f","\u68c0\u67e5\u6587\u4ef6\u683c\u5f0f\u662f\u5426\u652f\u6301","\u5c1d\u8bd5\u4f7f\u7528\u8f83\u5c0f\u7684\u6587\u4ef6"],FILE_TOO_LARGE:["\u538b\u7f29\u97f3\u9891\u6587\u4ef6","\u4f7f\u7528\u8f83\u77ed\u7684\u97f3\u9891\u7247\u6bb5","\u964d\u4f4e\u97f3\u9891\u8d28\u91cf"],UNSUPPORTED_FORMAT:["\u8f6c\u6362\u4e3aWAV\u3001MP3\u6216FLAC\u683c\u5f0f","\u4f7f\u7528\u97f3\u9891\u8f6c\u6362\u5de5\u5177","\u68c0\u67e5\u6587\u4ef6\u6269\u5c55\u540d"]};const re=se,ne=()=>{const[e,t]=(0,n.useState)(null),[s,r]=(0,n.useState)(0),[i,l]=(0,n.useState)(!1),[a,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),x=(0,n.useRef)(null),u=(0,n.useRef)(null),h=(0,n.useRef)(0),m={PENDING:"\u7b49\u5f85\u5904\u7406...",ANALYZING:"\u6b63\u5728\u5206\u6790\u97f3\u9891\u7279\u5f81...",FEATURE_EXTRACTION:"\u6b63\u5728\u63d0\u53d6\u97f3\u9891\u7279\u5f81...",PARAMETER_INVERSION:"\u6b63\u5728\u8ba1\u7b97\u98ce\u683c\u53c2\u6570...",AUDIO_RENDERING:"\u6b63\u5728\u6e32\u67d3\u97f3\u9891...",POST_PROCESSING:"\u6b63\u5728\u540e\u5904\u7406...",FINALIZING:"\u6b63\u5728\u5b8c\u6210\u5904\u7406...",COMPLETED:"\u5904\u7406\u5b8c\u6210",FAILED:"\u5904\u7406\u5931\u8d25"},p=(0,n.useCallback)(e=>e<10?1e3:e<50?2e3:e<90?1500:500,[]),g=(0,n.useCallback)(async e=>{if(e)try{const s=await ee.fE.getJobStatus(e);t(s);const n=s.progress||0;if(r(n),h.current=0,"COMPLETED"===s.status)d(s),l(!1),o(null),re.showSuccess("\u97f3\u9891\u5904\u7406\u5b8c\u6210\uff01"),x.current&&(clearTimeout(x.current),x.current=null);else if("FAILED"===s.status)o(s.error||"\u5904\u7406\u5931\u8d25"),l(!1),re.showError(new Error(s.error||"\u5904\u7406\u5931\u8d25"),"\u97f3\u9891\u5904\u7406"),x.current&&(clearTimeout(x.current),x.current=null);else{const t=p(n);x.current=setTimeout(()=>{g(e)},t)}}catch(a){console.error("Poll job status error:",a),h.current+=1,h.current<=3?(console.log("Retrying poll (".concat(h.current,"/").concat(3,")")),x.current=setTimeout(()=>{g(e)},3e3)):(o("\u83b7\u53d6\u4efb\u52a1\u72b6\u6001\u5931\u8d25"),l(!1),re.showError(a,"\u83b7\u53d6\u4efb\u52a1\u72b6\u6001"))}},[p]),j=(0,n.useCallback)(async e=>{try{l(!0),o(null),r(0),d(null),h.current=0,u.current=new AbortController;const t=await ee.fE.createJob(e);return g(t.job_id),t}catch(a){throw o("\u521b\u5efa\u5904\u7406\u4efb\u52a1\u5931\u8d25"),l(!1),re.showError(a,"\u521b\u5efa\u5904\u7406\u4efb\u52a1"),a}},[g]),A=(0,n.useCallback)(async()=>{try{if(u.current&&u.current.abort(),x.current&&(clearTimeout(x.current),x.current=null),null!==e&&void 0!==e&&e.job_id)try{await ee.fE.cancelJob(e.job_id)}catch(a){console.warn("Failed to cancel server job:",a)}l(!1),t(null),r(0),o(null),re.showWarning("\u5904\u7406\u5df2\u53d6\u6d88")}catch(a){console.error("Cancel processing error:",a),re.showError(a,"\u53d6\u6d88\u5904\u7406")}},[e]),y=(0,n.useCallback)(()=>{x.current&&(clearTimeout(x.current),x.current=null),u.current&&u.current.abort(),l(!1),t(null),r(0),d(null),o(null),h.current=0},[]),f=(0,n.useCallback)(()=>e?m[e.status]||e.status:"\u7b49\u5f85\u5f00\u59cb",[e]);return(0,n.useEffect)(()=>()=>{x.current&&clearTimeout(x.current),u.current&&u.current.abort()},[]),{jobStatus:e,progress:s,processing:i,error:a,result:c,startProcessing:j,cancelProcessing:A,resetState:y,getStatusMessage:f,canCancel:i&&"FINALIZING"!==(null===e||void 0===e?void 0:e.status)}},{Title:ie,Text:le}=i.A,ae=()=>{const[e,t]=(0,n.useState)("A"),[s,i]=(0,n.useState)(null),[f,v]=(0,n.useState)(null),{jobStatus:b,progress:E,processing:R,error:S,result:w,startProcessing:C,cancelProcessing:k,resetState:F,getStatusMessage:M,canCancel:I}=ne(),[L,z]=(0,n.useState)({reference:{percent:0,uploading:!1,speed:"",timeRemaining:""},target:{percent:0,uploading:!1,speed:"",timeRemaining:""}}),N=(0,n.useCallback)(async e=>{try{z(e=>(0,r.A)((0,r.A)({},e),{},{reference:{percent:0,uploading:!0,speed:"",timeRemaining:""}}));const t=await ee.fE.getUploadSignature(e.type,".wav");await ee.wr.uploadToStorage(e,t.upload_url,e=>{z(t=>(0,r.A)((0,r.A)({},t),{},{reference:{percent:e.percent,uploading:!0,speed:e.speedText||"",timeRemaining:e.timeText||""}}))}),i({name:e.name,key:t.object_key,file:e}),z(e=>(0,r.A)((0,r.A)({},e),{},{reference:{percent:100,uploading:!1,speed:"",timeRemaining:""}})),re.showSuccess("\u53c2\u8003\u97f3\u9891\u4e0a\u4f20\u6210\u529f")}catch(S){console.error("Reference upload failed:",S),z(e=>(0,r.A)((0,r.A)({},e),{},{reference:{percent:0,uploading:!1,speed:"",timeRemaining:""}})),re.showError(S,"\u53c2\u8003\u97f3\u9891\u4e0a\u4f20")}},[]),P=(0,n.useCallback)(async e=>{try{z(e=>(0,r.A)((0,r.A)({},e),{},{target:{percent:0,uploading:!0,speed:"",timeRemaining:""}}));const t=await ee.fE.getUploadSignature(e.type,".wav");await ee.wr.uploadToStorage(e,t.upload_url,e=>{z(t=>(0,r.A)((0,r.A)({},t),{},{target:{percent:e.percent,uploading:!0,speed:e.speedText||"",timeRemaining:e.timeText||""}}))}),v({name:e.name,key:t.object_key,file:e}),z(e=>(0,r.A)((0,r.A)({},e),{},{target:{percent:100,uploading:!1,speed:"",timeRemaining:""}})),re.showSuccess("\u76ee\u6807\u97f3\u9891\u4e0a\u4f20\u6210\u529f")}catch(S){console.error("Target upload failed:",S),z(e=>(0,r.A)((0,r.A)({},e),{},{target:{percent:0,uploading:!1,speed:"",timeRemaining:""}})),re.showError(S,"\u76ee\u6807\u97f3\u9891\u4e0a\u4f20")}},[]);return(0,_.jsxs)("div",{className:"audio-processor",children:[(0,_.jsx)(l.A,{title:"\u5904\u7406\u6a21\u5f0f",style:{marginBottom:24},children:(0,_.jsx)(a.Ay.Group,{value:e,onChange:e=>t(e.target.value),children:(0,_.jsxs)(o.A,{direction:"vertical",children:[(0,_.jsxs)(a.Ay,{value:"A",children:[(0,_.jsx)("strong",{children:"A \u6a21\u5f0f - \u914d\u5bf9\u6a21\u5f0f"}),(0,_.jsx)("br",{}),(0,_.jsx)(le,{type:"secondary",children:"\u53c2\u8003\u97f3\u9891\u548c\u76ee\u6807\u97f3\u9891\u662f\u540c\u4e00\u7d20\u6750\u7684\u4e0d\u540c\u7248\u672c\uff0c\u7cfb\u7edf\u4f1a\u8fdb\u884c\u65f6\u95f4\u5bf9\u9f50\u548c\u7cbe\u786e\u5339\u914d"})]}),(0,_.jsxs)(a.Ay,{value:"B",children:[(0,_.jsx)("strong",{children:"B \u6a21\u5f0f - \u98ce\u683c\u6a21\u5f0f"}),(0,_.jsx)("br",{}),(0,_.jsx)(le,{type:"secondary",children:"\u53c2\u8003\u97f3\u9891\u548c\u76ee\u6807\u97f3\u9891\u662f\u4e0d\u540c\u7d20\u6750\uff0c\u7cfb\u7edf\u4f1a\u5b66\u4e60\u53c2\u8003\u97f3\u9891\u7684\u98ce\u683c\u7279\u5f81\u5e76\u5e94\u7528\u5230\u76ee\u6807\u97f3\u9891"})]})]})})}),(0,_.jsxs)(c.A,{gutter:[24,24],children:[(0,_.jsx)(d.A,{xs:24,lg:12,children:(0,_.jsxs)(l.A,{title:"\u53c2\u8003\u97f3\u9891",className:"upload-card",children:[(0,_.jsx)(T,{onFileSelect:N,accept:"audio/*",title:"\u4e0a\u4f20\u53c2\u8003\u97f3\u9891",description:"\u5df2\u7ecf\u8fc7\u8c03\u97f3\u5904\u7406\u7684\u97f3\u9891\u6587\u4ef6",file:s}),L.reference.uploading&&(0,_.jsxs)("div",{style:{marginTop:16},children:[(0,_.jsx)(x.A,{percent:L.reference.percent,status:"active",format:e=>"".concat(e,"%")}),(0,_.jsxs)("div",{style:{marginTop:8,fontSize:"12px",color:"#666"},children:[L.reference.speed&&(0,_.jsxs)("span",{children:["\u901f\u5ea6: ",L.reference.speed]}),L.reference.timeRemaining&&(0,_.jsxs)("span",{style:{marginLeft:16},children:["\u5269\u4f59\u65f6\u95f4: ",L.reference.timeRemaining]})]})]}),s&&(0,_.jsx)(O,{file:s.file,title:"\u53c2\u8003\u97f3\u9891"})]})}),(0,_.jsx)(d.A,{xs:24,lg:12,children:(0,_.jsxs)(l.A,{title:"\u76ee\u6807\u97f3\u9891",className:"upload-card",children:[(0,_.jsx)(T,{onFileSelect:P,accept:"audio/*",title:"\u4e0a\u4f20\u76ee\u6807\u97f3\u9891",description:"\u9700\u8981\u8c03\u97f3\u5904\u7406\u7684\u539f\u59cb\u97f3\u9891\u6587\u4ef6",file:f}),L.target.uploading&&(0,_.jsxs)("div",{style:{marginTop:16},children:[(0,_.jsx)(x.A,{percent:L.target.percent,status:"active",format:e=>"".concat(e,"%")}),(0,_.jsxs)("div",{style:{marginTop:8,fontSize:"12px",color:"#666"},children:[L.target.speed&&(0,_.jsxs)("span",{children:["\u901f\u5ea6: ",L.target.speed]}),L.target.timeRemaining&&(0,_.jsxs)("span",{style:{marginLeft:16},children:["\u5269\u4f59\u65f6\u95f4: ",L.target.timeRemaining]})]})]}),f&&(0,_.jsx)(O,{file:f.file,title:"\u76ee\u6807\u97f3\u9891"})]})})]}),(0,_.jsx)(l.A,{style:{marginTop:24},children:(0,_.jsx)("div",{style:{textAlign:"center"},children:(0,_.jsxs)(o.A,{size:"large",direction:"vertical",style:{width:"100%"},children:[(0,_.jsx)("div",{children:(0,_.jsxs)(o.A,{children:[(0,_.jsx)(u.Ay,{type:"primary",size:"large",onClick:async()=>{if(s&&f)try{await C({mode:e,ref_key:s.key,tgt_key:f.key})}catch(S){console.error("Start processing failed:",S)}else re.showSimpleError(new Error("\u8bf7\u5148\u4e0a\u4f20\u53c2\u8003\u97f3\u9891\u548c\u76ee\u6807\u97f3\u9891"),"\u5f00\u59cb\u5904\u7406")},disabled:!s||!f||R,loading:R,style:{minWidth:120},children:R?"\u5904\u7406\u4e2d...":"\u5f00\u59cb\u5904\u7406"}),I&&(0,_.jsx)(u.Ay,{danger:!0,size:"large",onClick:k,icon:(0,_.jsx)(A.A,{}),style:{minWidth:100},children:"\u53d6\u6d88"}),(w||S)&&!R&&(0,_.jsx)(u.Ay,{size:"large",onClick:()=>{i(null),v(null),F()},children:"\u91cd\u65b0\u5f00\u59cb"})]})}),(R||w||S)&&(0,_.jsxs)("div",{children:[(0,_.jsxs)(o.A,{align:"center",children:[R?(0,_.jsx)(p.A,{spin:!0}):w?(0,_.jsx)(g.A,{style:{color:"#52c41a"}}):S?(0,_.jsx)(j.A,{style:{color:"#ff4d4f"}}):null,(0,_.jsx)(le,{children:M()})]}),R&&(0,_.jsxs)("div",{style:{marginTop:16},children:[(0,_.jsx)(x.A,{percent:E,style:{maxWidth:400},strokeColor:{"0%":"#3CE6BE","100%":"#46BEAA"},trailColor:"rgba(70, 190, 170, 0.3)",showInfo:!0,format:e=>"".concat(e,"%")}),(null===b||void 0===b?void 0:b.estimated_time)&&(0,_.jsxs)(le,{style:{fontSize:"12px",color:"#B4FFF0",marginTop:8,display:"block"},children:["\u9884\u8ba1\u5269\u4f59\u65f6\u95f4: ",b.estimated_time]})]})]}),S&&(0,_.jsx)(h.A,{message:"\u64cd\u4f5c\u5931\u8d25",description:(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{style:{marginBottom:8},children:S}),(0,_.jsxs)("div",{style:{fontSize:"12px",color:"#666"},children:[(0,_.jsx)("strong",{children:"\u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u6848\uff1a"}),(0,_.jsxs)("ul",{style:{margin:"4px 0",paddingLeft:"16px"},children:[S.includes("\u4e0a\u4f20")&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("li",{children:"\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u662f\u5426\u7a33\u5b9a"}),(0,_.jsx)("li",{children:"\u786e\u8ba4\u6587\u4ef6\u683c\u5f0f\u4e3a\u652f\u6301\u7684\u97f3\u9891\u683c\u5f0f\uff08MP3\u3001WAV\u3001FLAC\u7b49\uff09"}),(0,_.jsx)("li",{children:"\u5c1d\u8bd5\u4e0a\u4f20\u8f83\u5c0f\u7684\u6587\u4ef6\uff08\u5efa\u8bae\u5c0f\u4e8e100MB\uff09"})]}),S.includes("\u5904\u7406")&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("li",{children:"\u786e\u8ba4\u4e0a\u4f20\u7684\u6587\u4ef6\u662f\u6709\u6548\u7684\u97f3\u9891\u6587\u4ef6"}),(0,_.jsx)("li",{children:"\u68c0\u67e5\u97f3\u9891\u6587\u4ef6\u662f\u5426\u635f\u574f"}),(0,_.jsx)("li",{children:"\u7a0d\u540e\u91cd\u8bd5\uff0c\u53ef\u80fd\u662f\u670d\u52a1\u5668\u6682\u65f6\u7e41\u5fd9"})]}),!S.includes("\u4e0a\u4f20")&&!S.includes("\u5904\u7406")&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("li",{children:"\u5237\u65b0\u9875\u9762\u91cd\u8bd5"}),(0,_.jsx)("li",{children:"\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5"}),(0,_.jsx)("li",{children:"\u5982\u95ee\u9898\u6301\u7eed\uff0c\u8bf7\u8054\u7cfb\u6280\u672f\u652f\u6301"})]})]})]})]}),type:"error",showIcon:!0,closable:!0,onClose:()=>F(),style:{maxWidth:600}}),w&&(0,_.jsx)(h.A,{message:"\u5904\u7406\u5b8c\u6210",description:"\u97f3\u9891\u8c03\u97f3\u5904\u7406\u5df2\u5b8c\u6210\uff0c\u60a8\u53ef\u4ee5\u4e0b\u8f7d\u7ed3\u679c\u6216\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f",type:"success",showIcon:!0,action:(0,_.jsxs)(u.Ay,{size:"small",onClick:()=>{null!==w&&void 0!==w&&w.download_url&&window.open(w.download_url,"_blank")},children:[(0,_.jsx)(y.A,{})," \u4e0b\u8f7d\u7ed3\u679c"]}),style:{maxWidth:500}})]})})}),w&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(m.A,{children:"\u5904\u7406\u7ed3\u679c"}),(0,_.jsx)(l.A,{title:"AB \u5bf9\u6bd4\u64ad\u653e",style:{marginTop:24},children:(0,_.jsxs)(c.A,{gutter:[24,24],children:[(0,_.jsx)(d.A,{xs:24,lg:12,children:(0,_.jsxs)("div",{className:"ab-section",children:[(0,_.jsx)(ie,{level:5,children:"\u539f\u59cb\u97f3\u9891"}),(0,_.jsx)(O,{file:f.file,title:"\u76ee\u6807\u97f3\u9891\uff08\u5904\u7406\u524d\uff09"})]})}),(0,_.jsx)(d.A,{xs:24,lg:12,children:(0,_.jsxs)("div",{className:"ab-section",children:[(0,_.jsx)(ie,{level:5,children:"\u5904\u7406\u540e\u97f3\u9891"}),(0,_.jsx)(O,{url:w.download_url,title:"\u5904\u7406\u540e\u97f3\u9891"})]})})]})}),(0,_.jsx)(q,{jobStatus:w,style:{marginTop:24}}),(0,_.jsx)(Y,{parameters:w.style_params,onParametersChange:e=>{console.log("Parameters changed:",e)},style:{marginTop:24}})]})]})}}}]);